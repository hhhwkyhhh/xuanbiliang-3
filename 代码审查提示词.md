# MIMO 随机振动控制系统代码深度审查提示词

## 推荐使用以下提示词让另一个 Agent 进行深度审查：

---

## 提示词（中文版）

```
这是一个悬臂梁 MIMO (多输入多输出) 随机振动控制仿真项目，基于矩阵幂次控制算法实现闭环振动控制。请对整个项目进行全面深度审查。

## 项目背景
- 目标：使悬臂梁控制点的响应功率谱密度收敛到预设的参考谱
- 核心算法：矩阵幂次控制算法（论文 4.3-4.4 节）
- 系统配置：2 输入 × 2 输出，频率分辨率 1Hz，采样率 5120Hz

## 审查要求

### 1. 算法正确性审查
请对照 `参考的论文/矩阵幂次控制算法原理/矩阵幂次控制算法.md` 中的公式，验证以下实现：
- 修正矩阵 Δ = L × Ls^(-1) 的计算是否正确
- 更新公式 L_new = Δ^ε × L_old 是否正确
- Cholesky 分解的使用是否正确（下三角 vs 上三角）

### 2. 信号流一致性审查
检查以下模块之间的数据维度和信号流是否匹配：
- Signal_Generator (L, Z) → 驱动力 u
- State-Space → 加速度响应 y
- Buffer → Response_spectrum_calculation → Syy
- Controller (L_old, Syy, R, isPeriod) → L_new
- Unit Delay 反馈链路

### 3. 参数一致性审查
核对以下参数在不同文件中是否统一：
- N_frame / N = 5120 (对应 1Hz 分辨率)
- N_half = 2561
- AvgNum = 30
- epsilon = 0.5
- Overlap = 2560

### 4. 数值稳定性审查
检查以下保护机制：
- Syy 正定性保护（特征值修正）
- R 正定性保护
- Delta 条件数检查
- 低频段/高频段容错处理

### 5. 潜在问题识别
请特别关注：
- 可能导致控制发散的因素
- 时序同步问题（Unit Delay 采样周期与控制周期）
- 复数矩阵运算的正确性
- 边界条件处理（DC、Nyquist 频率）

## 文件结构说明

### M 脚本文件
- `spaceABCD.m` - 悬臂梁有限元状态空间模型生成
- `system_model.m` - 频响函数 H 和逆系统 Z 计算
- `prepare_control_model.m` - 控制仿真初始化（参考谱 R，初始值 L_init）
- `H1_plot.m` - 频响函数绘图
- `verify_control_results.m` - 控制效果验证

### Simulink 模型（已解压为 XML）
- `H_Estimation_extract/` - 系统辨识模型
- `control_model_extract/` - 闭环控制模型

SLX 模型内的 MATLAB Function 代码位于 `simulink/stateflow/chart_*.xml` 文件中。

### 参考论文
- `参考的论文/full.md` - 完整论文
- `参考的论文/矩阵幂次控制算法原理/矩阵幂次控制算法.md` - 核心算法推导

请给出详细的审查报告，包括：发现的问题、问题严重程度、具体位置、修复建议。
```

---

## 提示词（英文版）

```
This is a cantilever beam MIMO (Multi-Input Multi-Output) random vibration control simulation project based on the Matrix Power Control Algorithm. Please conduct a comprehensive code review.

## Project Overview
- Goal: Make the response PSD at control points converge to a preset reference spectrum
- Core Algorithm: Matrix Power Control Algorithm (Paper Section 4.3-4.4)
- System Configuration: 2 inputs × 2 outputs, 1Hz frequency resolution, 5120Hz sampling rate

## Review Requirements

### 1. Algorithm Correctness
Verify against the formulas in `参考的论文/矩阵幂次控制算法原理/矩阵幂次控制算法.md`:
- Correction matrix Δ = L × Ls^(-1) calculation
- Update formula L_new = Δ^ε × L_old
- Cholesky decomposition usage (lower vs upper triangular)

### 2. Signal Flow Consistency
Check data dimensions and signal flow between modules:
- Signal_Generator → Drive force u
- State-Space → Acceleration response y
- Buffer → Response_spectrum_calculation → Syy
- Controller → L_new
- Unit Delay feedback loop

### 3. Parameter Consistency
Verify these parameters are consistent across all files:
- N_frame / N = 5120 (for 1Hz resolution)
- N_half = 2561
- AvgNum = 30
- epsilon = 0.5
- Overlap = 2560

### 4. Numerical Stability
Check protection mechanisms:
- Syy positive-definiteness protection
- R regularization
- Delta condition number check
- Low/high frequency edge case handling

### 5. Potential Issues
Pay special attention to:
- Factors that could cause control divergence
- Timing synchronization (Unit Delay vs control period)
- Complex matrix operations correctness
- Boundary conditions (DC, Nyquist frequency)

Please provide a detailed review report with: issues found, severity, location, and fix suggestions.
```

---

## 快速启动命令

如果使用 Claude/GPT 等 Agent，可以先发送以下命令让其熟悉项目：

```
请先阅读以下文件了解项目结构：
1. 修改频率分辨率方案.md - 最新的系统配置
2. 参考的论文/矩阵幂次控制算法原理/矩阵幂次控制算法.md - 核心算法
3. prepare_control_model.m - 初始化脚本
4. control_model_extract/simulink/stateflow/chart_30.xml - Controller 核心代码
5. control_model_extract/simulink/stateflow/chart_48.xml - Signal_Generator 代码
6. control_model_extract/simulink/stateflow/chart_40.xml - Response_spectrum_calculation 代码
```
